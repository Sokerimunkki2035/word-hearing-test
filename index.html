<!-- Hearing Lab v8.2 ‚Äì Suomi ‚Äì Build #2312 ‚Äì November 2025 -->
<!doctype html>
<html lang="fi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hearing Lab v8.2 ‚Äì Kuulotesti (Suomi)</title>
<style>
body{font-family:sans-serif;background:#f8fafc;color:#111;margin:0;padding:20px;text-align:center}
button{background:#2563eb;color:#fff;border:none;border-radius:8px;padding:10px 18px;font-size:16px;margin:6px;cursor:pointer}
input,select{padding:8px;border:1px solid #ccc;border-radius:6px}
.card{background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin:20px auto;padding:20px;max-width:420px}
.hidden{display:none}
.version{color:#555;font-size:14px;margin-bottom:8px}
footer{margin-top:30px;font-size:12px;color:#555}
</style>
</head>
<body>
<h1>Hearing Lab ‚Äì Kuulotesti</h1>
<div class="version">Versio 8.2 (Suomi ‚Ä¢ Build #2312)</div>

<div class="card" id="kalib">
 <h2>Kalibrointi</h2>
 <p>Soita 1 kHz √§√§ni ja s√§√§d√§ √§√§nenvoimakkuus mukavaksi.</p>
 <button onclick="playTone(1000)">‚ñ∂ Soita 1 kHz</button>
 <button onclick="stopTone()">‚èπ Pys√§yt√§</button><br><br>
 <button onclick="next('hyper')">Seuraava ‚Üí √Ñ√§niyliherkkyystesti</button>
</div>

<div class="card hidden" id="hyper">
 <h2>√Ñ√§niyliherkkyystesti</h2>
 <p>Kuuntele sanaa eri voimakkuuksilla (20‚Äì100 %) ja arvioi milt√§ se tuntuu.</p>
 <p id="volLabel"></p>
 <button onclick="playNextVol()">‚ñ∂ Soita seuraava</button><br>
 <button onclick="rate('miellytt√§v√§')">Miellytt√§v√§</button>
 <button onclick="rate('kuuluu')">Kuuluu</button>
 <button onclick="rate('kovahko')">Kovahko</button>
 <button onclick="rate('ep√§miellytt√§v√§')">Ep√§miellytt√§v√§</button><br><br>
 <button onclick="next('words')">Seuraava ‚Üí Sanatesti</button>
</div>

<div class="card hidden" id="words">
 <h2>Sanatesti</h2>
 <p>Voit lis√§t√§ tausta√§√§nen:</p>
 <select id="noiseSelect" onchange="changeNoise(this.value)">
   <option value="none">Ei taustaa</option>
   <option value="cafe">‚òï Kahvila</option>
   <option value="traffic">üöó Liikenne</option>
   <option value="white">üåß Valkoinen kohina</option>
 </select>
 <p id="wordNum"></p>
 <button onclick="playWord()">‚ñ∂ Soita sana</button><br><br>
 <input id="ans" placeholder="Kirjoita sana"><br><br>
 <button onclick="submitAns()">L√§het√§</button>
 <button onclick="skip()">Ohi</button>
</div>

<div class="card hidden" id="result">
 <h2>Tulokset</h2>
 <p id="hyperRes"></p>
 <p id="score"></p>
 <button onclick="location.reload()">Aloita alusta</button>
</div>

<footer>Hearing Lab v8.2 ‚Ä¢ Suomi ‚Ä¢ Build #2312 ‚Ä¢ November 2025</footer>

<script>
// --- √Ñ√§nen toisto ---
let ctx,osc,gain;
function playTone(f){
 if(!ctx){ctx=new(window.AudioContext||window.webkitAudioContext)();
  osc=ctx.createOscillator();gain=ctx.createGain();
  osc.connect(gain).connect(ctx.destination);osc.start();}
 osc.frequency.value=f;gain.gain.value=0.1;
}
function stopTone(){if(gain)gain.gain.value=0;}
function next(id){document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');}

// --- √Ñ√§niyliherkkyys voimakkuuksilla ---
const vols=[0.2,0.4,0.6,0.8,1.0];let vIndex=0;let arvio=[];
function playNextVol(){
 if(!ctx){ctx=new(window.AudioContext||window.webkitAudioContext)();}
 const utter=new SpeechSynthesisUtterance("koira");
 utter.lang="fi-FI"; utter.volume=vols[vIndex];
 speechSynthesis.speak(utter);
 document.getElementById("volLabel").textContent=Math.round(vols[vIndex]*100)+" %";
}
function rate(v){
 if(vIndex<vols.length){arvio.push(Math.round(vols[vIndex]*100)+"%: "+v);vIndex++;
  if(vIndex>=vols.length)alert("Testi valmis ‚Äì siirry sanatestiin.");}
}

// --- Tausta√§√§net ---
let noiseAudio=null;
function changeNoise(type){
 if(noiseAudio){noiseAudio.pause();noiseAudio=null;}
 if(type==="none")return;
 let src="";
 if(type==="cafe")src="https://cdn.jsdelivr.net/gh/itsmyid/noises/cafe.mp3";
 if(type==="traffic")src="https://cdn.jsdelivr.net/gh/itsmyid/noises/traffic.mp3";
 if(type==="white")src="https://cdn.jsdelivr.net/gh/itsmyid/noises/white.mp3";
 noiseAudio=new Audio(src);noiseAudio.loop=true;noiseAudio.volume=0.2;noiseAudio.play();
}

// --- Sanatesti ---
const sanat=["kissa","koira","talo","kirja","tuoli","auto","tie","ovi","s√§nky","kuu",
"aurinko","sade","lumi","kello","lehti","matto","sieni","peili","kukka","lasi",
"kala","hevonen","laiva","leip√§","p√∂yt√§","silta","ranta","mets√§","j√§rvi","kauppa",
"koulu","kuva","puu","l√§√§k√§ri","juna","bussi","polku","portti","ikkuna","musiikki",
"paperi","kyn√§","perhe","yst√§v√§","valo","√§√§ni","katto","laulu","sormus","nappi"];
let i=0,ok=0;
function playWord(){const u=new SpeechSynthesisUtterance(sanat[i]);u.lang="fi-FI";speechSynthesis.speak(u);
 document.getElementById("wordNum").textContent="Sana "+(i+1)+" / "+sanat.length;}
function submitAns(){
 const a =document
